# F1 Wing Optimization using Reinforcement Learning and Surrogate Modeling

## Author Information

- **Name:** Abhinav Kalsi  
- **Affiliation:** Rochester Institute of Technology (RIT)  
- **Program:** MS in Artificial Intelligence  
- **Contact:** ak4975@rit.edu  

---

## Project Overview

This project presents a framework that utilizes reinforcement learning (RL) combined with surrogate aerodynamic modeling to optimize Formula 1 wing designs. The surrogate model, trained on synthetic CFD data generated by XFoil, accelerates the evaluation of aerodynamic metrics such as lift-to-drag ratio (L/D). The reinforcement learning agent, implemented using Proximal Policy Optimization (PPO), iteratively improves wing designs for optimal aerodynamic performance.

---

## Project Architecture

![Architecture Diagram](figures/ppo.png)

**Fig. 1**: Framework integrating surrogate modeling and PPO reinforcement learning for aerodynamic optimization.

---

## Repository Structure

f1-wing-optimization/
├── README.md
├── requirements.txt
├── data/
│   ├── raw/                   # UIUC airfoil `.dat` files
│   ├── processed/             # CSV files from XFoil simulations
│   └── surrogate_dataset.csv  # Dataset for surrogate training
├── surrogate_model/
│   ├── train_surrogate.py     # Script for surrogate model training
│   ├── predict_surrogate.py   # Script for surrogate predictions
│   └── surrogate_model.pth    # Saved surrogate model weights
├── reinforcement_learning/
│   ├── ppo_optimization.py    # PPO training script
│   ├── ppo_model_eval.py      # PPO model evaluation script
│   └── trained_ppo_model.zip  # Trained PPO model file
├── xfoil_integration/
│   ├── run_xfoil.cpp                   # Automated CFD runs using XFoil
│   ├── build_surrogate_dataset.cpp     # Convert CFD results into surrogate dataset
│   └── final_cfd_results.csv           # Aggregated CFD results
├── utils/
│   ├── convert_csv_numpy.py    # Utility: convert CSV to NumPy arrays
│   ├── data.py                 # Utility: data loading and preprocessing
│   └── visualize.py            # Utility: plotting and visualization scripts
└── figures/
    ├── architecture.png        # Project framework visualization
    ├── LD_vs_AoA.png           # Lift-to-drag vs AoA visualization
    ├── CL_vs_AoA.png           # Lift coefficient vs AoA
    └── CD_vs_AoA.png           # Drag coefficient vs AoA


---

## Installation and Setup

### Environment Setup

- **Python:** 3.9 or later
- **PyTorch:** 2.0+
- **Stable-Baselines3:** 2.3.2+
- **XFoil:** Obtain from [XFoil Website](https://web.mit.edu/drela/Public/web/xfoil/)
- **C++ Compiler:** Supporting C++17 standard (e.g., GCC, MSVC)
- **OpenMP:** Required for parallel processing (integrated with your C++ compiler)

Install Python dependencies:

```bash
pip install -r requirements.txt



## Data Preparation

1. **Download Raw Airfoil Coordinates**  
   - Go to the UIUC Airfoil Database:  
     https://m-selig.ae.illinois.edu/ads/coord_database.html  
   - Download all the `.dat` files for the airfoils you want to include.  
   - Place them in `data/raw/` (create this folder if it doesn’t exist).

2. **Generate Synthetic CFD Data with XFoil**  
   - Compile the XFoil runner (requires C++17, OpenMP, and filesystem support):
     ```bash
     g++ -std=c++17 xfoil_integration/run_xfoil.cpp \
         -o run_xfoil -fopenmp -lstdc++fs
     ```
   - Run it from the project root:
     ```bash
     ./run_xfoil
     ```
   - This will read each `.dat` file in `data/raw/`, sweep AoA from −5° to 15°, and write `.pol`/.dump files into `data/processed/`.

3. **Aggregate Aerodynamic Results**  
   - Compile and run the aggregator:
     ```bash
     g++ -std=c++17 xfoil_integration/aggregate_aero_data.cpp \
         -o aggregate_aero_data -fopenmp -lstdc++fs
     ./aggregate_aero_data
     ```
   - Output: `xfoil_integration/final_cfd_results.csv`, containing CL, CD, Xtr, L/D for each foil and AoA.

4. **Build the Surrogate Dataset**  
   - Compile and execute the feature‐builder:
     ```bash
     g++ -std=c++17 xfoil_integration/build_surrogate_dataset.cpp \
         -o build_surrogate_dataset -lstdc++fs
     ./build_surrogate_dataset
     ```
   - Reads `final_cfd_results.csv` and the original coordinate CSVs in `data/raw/parsed_data/`, computes geometry features (max thickness, camber, etc.), and writes `data/surrogate_dataset.csv`.

---

## Surrogate Model Training

- **Python version**:
  ```bash
  python train_surrogate.py \
      --data data/surrogate_dataset.csv \
      --epochs 500 \
      --out surrogate_model.pth

- **C++ version**:
g++ -std=c++17 train_surrogate.cpp \
    -o train_surrogate \
    -I/path/to/libtorch/include \
    -L/path/to/libtorch/lib -ltorch -lc10 \
    -Wl,-rpath,/path/to/libtorch/lib
./train_surrogate


## PPO Agent Training

python reinforcement_learning/ppo_optimization.py \
    --surrogate surrogate_model.pth \
    --output trained_ppo_model.zip \
    --timesteps 51200

##Evaluation

python predict_surrogate.py \
    --model surrogate_model.pth \
    --feat 5.0 1.0 0.08 0.25 0.04 0.50


python reinforcement_learning/ppo_model_eval.py \
    --ppo trained_ppo_model.zip \
    --surrogate surrogate_model.pth
